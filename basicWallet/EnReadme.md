# Chapter 2: Wallet Basics

## 1. Wallet-related terms

* Mnemonic words: Generate 12-24 words from the lexicon through algorithms, currently supporting multiple languages.

* Random seed: A random string generated by an algorithm using a mnemonic word.

* Private key: The most important thing in the wallet. The wallet actually manages the private key. Now the private key is divided into master private key and derived private key.

* Master private key: Wallet private key, generated from a random seed generated by the mnemonic phrase. If the master private key is stolen, all the money in your wallet will be stolen.

* Derived private key: The private key generated by the master private key through the bip layered protocol. If the derived private key is lost, only the digital assets on a single account will be lost.

* Backup wallet: In fact, it is also called backup mnemonic phrase. Today's wallets are basically restored using mnemonic phrases.

* Backup private key: Back up the main private key or derived private key of the wallet. All accounts in the wallet can be retrieved through the master private key, and only one of the accounts can be retrieved through the derived private key.

* Import wallet: Generate a previous wallet by importing a mnemonic phrase or private key.

* Import private key: Generate a multi-chain multi-account wallet or a single-chain single-account wallet by importing the private key.

* Single-chain wallet: A wallet that only supports one chain, such as a Bitcoin wallet.

* Multi-chain wallet: Wallet that supports all currencies.

*Single account wallet: Each currency only supports one account.

*Multi-account wallet: supports multiple accounts for each currency.

* Address: Similar to a bank card account, you can check the current account balance through the address.

* Public key: a secret key open to everyone.

* Signature: When initiating a digital asset transfer, all currencies must sign the transfer data. The amount of signature data is different for different currencies.

* Airdrop: It means dropping coins in batches.

* bip protocol cluster: an important stipulation in the HD layered wallet, which is an inevitable product of the development of digital currency.

* Non-deterministic wallet: Each account corresponds to a private key, and the private key is difficult to manage.

* Deterministic wallet: It has a master private key, through which the private keys of all other currencies can be produced. A single wallet cannot support multiple accounts.

* Deterministic hierarchical wallet: It has a master private key, through which the private keys of all other currencies can be produced, and supports multiple accounts.

### About wallet

A common misconception among cryptocurrencies about wallets is that they store tokens. The wallet does not store Tokens. The role of the wallet is to store private keys in encrypted files and sign transactions.

Users typically build a transaction object through an interface, send that object to the wallet to be signed, and the wallet returns that transaction object with the signature, which is then broadcast to the network. If the network confirms that the transaction is valid, it is included in a block on the blockchain.

## 2. Introduction to wallets in the current market

### 1. Ethereum’s Mist wallet

Speaking of Ethereum wallets, the first thing to talk about is of course the Ethereum official wallet + browser Mist. Mist is a full-node wallet (a full-node wallet is generally a wallet that synchronizes all Ethereum block information). That is to say, after opening the wallet, the computer will automatically synchronize all Ethereum block information, but it will take a long time to synchronize the existing Ethereum public chain data. Mist can also be used on your private chain during development. We will introduce the details of Mist in detail later.

### 2.Parity

Parity's goal is to be the fastest, lightest, and most secure Ethereum client. Parity is developed using the cutting-edge Rust programming language. Parity is GPLv3 licensed and can be used for Ethereum’s wallet needs. A wallet developed by some members of the original Ethereum Foundation. Powerful and also a full node wallet.

### 3.MyEtherWallet

As a light wallet, MyEtherWallet is easy to get started with. There is no need to download and all operations can be completed directly on the web page. The private key generated on MyEtherWallet is kept by the user himself, and the platform does not have a backup.

### 4.imToken

The mobile wallet is simple to operate, easy to use, and has complete functions. The wallet private key generated on imToken is saved locally on the mobile phone, and there is no backup on the platform.


### 5.MetaMask

MetaMask is a plug-in Ethereum wallet used on Google Chrome. The wallet does not require downloading. You only need to add the corresponding extension to Google Chrome. It is very lightweight and very convenient to use.


### 6.ledger
  Ledger is a hardware wallet, a hardware device that securely stores private keys. When viewing the wallet and sending transactions, the hardware wallet needs to be used in conjunction with the software wallet. You can either use the software wallet developed by Ledger itself or use the software wallet developed by other teams. Taking Ethereum as an example, you can use Ledger with the Ethereum web wallet myetherwallet.com or Parity wallet.
 
  ### 7.kcash
 
  Mobile wallet, easy to operate, supports single chain and multi-chain wallets.
 
  ### 8.biwrok
 
  An enterprise-level application wallet.
 
  ### 9.linkeye wallet
 
  A wallet used with the Linkeye public chain.
 
  ### 10.Tomato Wallet
 

If you know of any other wallets, you can provide the author and the author will add to it. The open source wallet is also provided to the author. The author will analyze the source code of the wallet later.

## 3. Development history of wallet

Wallets only contain keys, not coins. Each user has a wallet containing multiple keys. The wallet only contains a keychain of private/public key pairs. So don't misunderstand that a wallet contains money, a wallet is just a collection of private keys, and your coins are stored in the blocks of the blockchain.

### 1. Non-deterministic wallet

In the earliest batch of blockchain wallets, the wallet was just a collection of private keys. These private keys were independent of each other and had no relationship. We call this type of wallet a non-deterministic wallet. For example, the Bitcoin Core client pre-generates 100 random private keys, generating enough private keys from the beginning and using each key only once. Such wallets are now being replaced by deterministic wallets because they are difficult to manage, back up, and import. The disadvantage of random keys is that if you generate many private keys, you must keep copies of them all. This means that the wallet must be backed up regularly. Every key must be backed up, otherwise the funds controlled by the wallet will be lost if the wallet is inaccessible. This situation directly conflicts with the principle of avoiding address reuse - each Bitcoin address can only be used once for a transaction. Address reuse associates multiple transactions and addresses together, which reduces privacy. Type zero non-deterministic wallets are not a good choice when you want to avoid reusing addresses because you would be creating too many private keys and saving them. Although the Bitcoin Core client includes Zero Wallet, Bitcoin Core developers discourage its use.

.：
     ![.：
](https://github.com/guoshijiang/blockchain-wallet/blob/master/img/1785959-77bbcea7174071c3.png)


### 2. Deterministic wallet and deterministic layered wallet

All keys are derived from a master key, which is the seed. All keys in this type of wallet are related to each other, and all keys can be generated again if the original seed is available. There are many different key derivation methods used in deterministic wallets. The most common derivation method is to use a tree structure, called a hierarchical deterministic wallet or HD wallet


#### 2.1. Deterministic wallet

Deterministic, or "seed" wallets contain private keys that can be generated from a public seed using a single discrete function. The seed is a randomly generated number. This number also contains information such as an index number or a "chain code" that generates a private key (see section "Hierarchical Deterministic Wallets (BIP0032/BIP0044)"). In a deterministic wallet, the seed is enough to recover all the private keys that have been generated, so a simple backup during initial creation is enough. And the seed is enough for the wallet to import or export. This easily allows users' private keys to be easily transferred between wallets.

.：
     ![.：
](https://github.com/guoshijiang/blockchain-wallet/blob/master/img/1785959-be390ca284ed5f40.png)


#### 2.2. Hierarchical deterministic wallet

Deterministic wallets are developed to make it easier to generate many keys from a single "seed". The most advanced form of deterministic wallet is the HD wallet defined by the BIP0032 standard. HD wallets contain keys derived in a tree structure, so that a parent key can derive a series of child keys, and each child key can derive a series of grandchild keys, and so on, infinitely.

.：
     ![.：
](https://github.com/guoshijiang/blockchain-wallet/blob/master/img/1785959-7ce3000da8239b74.png)



Compared to random (non-deterministic) keys, HD wallets have two main advantages. First, tree structures can be used to express additional organizational meanings. For example, when a subkey of a specific branch is used to receive transaction income and there is a subkey of another branch responsible for paying expenses. Different branch keys can be used in an enterprise environment, which can govern different branches, subsidiaries, specific functions and accounting categories.

The second benefit of the HD wallet is that it allows users to create a sequence of public keys without accessing the corresponding private keys. This allows HD wallets to be used on unsecured servers or to issue a different public key with each transaction. The public key does not need to be pre-loaded or derived in advance, and the private key does not need to be used for payment in the server.

## 4. Wallet account system

In current blockchain technology, there are two main forms of accounting. The UTXO model represented by Bitcoin. UTXO is the abbreviation of this accounting model. Its full English spelling is Unspent Transaction Output, and its Chinese translation is " "Unspent transaction output"; the term "unspent transaction output" should be unfamiliar to most people. If you feel unfamiliar, please follow the breakdown below. The other is the account/balance-based accounting model represented by Ethereum. This account/balance-based accounting model is relatively simple. It is the same as the current bank card accounting method, and most people can understand it very clearly. understand this model.

### 1.UTXO model

#### 1.1. Model explanation
Before explaining the UTXO model, I would like to talk about a term called Transaction. Transaction and UTXO complement each other. Here is an example:

Zhang San: I got 120 Bitcoins through mining. Now Zhang San is hungry and wants to spend 2 Bitcoins to buy a piece of bread. This is just an example. At the current price of Bitcoin, 1 Bitcoin can buy a lot of bread.

Now let's assume that John Doe is the bakery owner

In this case, in Bitcoin, when Zhang San pays Li Si, he will pay Li Si 120 yuan in one time, and Li Si gives Zhang San 118 yuan in change. There are actually two transactions here. We can understand it this way, Zhang San’s The money was divided into two parts, 118 of which was given to myself, and the remaining 2 yuan was given to Li Si.

A network relationship is formed between transactions. The output of one transaction becomes the input of the next transaction; the output of the next transaction becomes the input of the next transaction. All money flows in this network, and the destination and source of every money are traceable, and this is also an important feature of the blockchain network.

The above explanation may be confusing to most people. Next, let’s explain in a more popular way what UTXO and Transaction are.

In real life, one transfer corresponds to one payer and one payee, while in Bitcoin, one transfer corresponds to multiple transferors and multiple payees.

Now let’s analyze the above example carefully. For the case of Zhang San buying bread,

Payer: Zhang San 120 yuan Payee: Zhang San 118 yuan, Li Si 2 yuan

Zhang San’s 120, transfer 118 yuan to himself, and transfer 2 yuan to Li Si, corresponding to the transaction, that is, this transaction has 1 input and 2 outputs!

Here is a case of multiple inputs and multiple outputs

Consider the following scenario: a transaction T3 occurs between user A and user B, and A transfers 100 yuan to B. A's 100 yuan, from T1: C transferred 80 yuan to A + T2: D transferred 30 yuan to A (a total of 110 yuan, but A only transferred 100 yuan to B, and the change of 10 yuan was returned to A's account) . In the same way, the 80 yuan transferred by C to A comes from a certain transaction of users E and F... The 30 yuan transferred by D to A comes from a certain transaction of user E...

This transaction has 2 inputs and 2 outputs: 2 inputs (that is, 2 UTXOs): T1: C transfers 80 yuan to A. T2: D transfers 30 yuan to A.

2 outputs: B: 100 yuan A: 10 yuan (change)

When you understand the above example, let's talk about UTXO again. Understanding the above example will be particularly helpful for you to understand UTXO.

1. Bitcoin transactions are not realized through the increase or decrease of accounts, but related input/output transactions.

2. Each transaction costs "input" and then generates "output". This generated "output" is the so-called "unspent transaction output", which is UTXO. Each transaction has a unique number, called transaction ID, which is calculated through a hash algorithm. When it is necessary to reference the "output" of a certain transaction, the transaction ID and transaction ID are mainly provided. The serial number in the "Output" list is sufficient.

3. Since there is no concept of an account, when the amount of the "input" part is greater than the required "output", you must give yourself change, and this change is also included in the "output" as part of the transaction.

4. Old UTXOs continue to die, and new UTXOs continue to be generated. All UTXOs, which constitutes the database of UTXO Set and exists in each node

5. Any UTXO can and can only be spent once by one transaction.

6.1 UTXO has the following expression form: 1 UTXO = 1 Transaction ID + Output Index

#### 1.2.Blockchain wallet balance form of UTXO model
Once you have a deep understanding of the concept of UTXO, it is easy to understand the wallet. The balance of a person's wallet = the sum of UTXO belonging to him; here, you will find a concept that is different from that in the "bank" in the real world. Here, how much money is left in each account will be stored. But here, what we store is not the balance of each account, but each transaction, that is, each UTXO. The balance of each account is calculated through UTXO, instead of directly storing the balance.

### 2. Account balance model
The account balance model is the same as today's bank cards. When we need to spend money, we will first check whether our balance is sufficient. The entire business process of transfer is the same as that of a bank card, based on the balance of the account.

## 4. Multiple signatures

### 1. Multi-signature overview

Multi-signature is a method of publishing a transaction with multiple signatures. If any of the parties does not sign, the transaction is invalid. The transaction is valid only if it is signed by any of the parties specified to sign. The benefit of multi-signature is that power is divided, allowing everyone who owns the transaction to exercise their own rights and ensure the security of the transaction they own.

The relevant definitions of multi-signature are given below.

* Signature system: In a multi-signature system, the collection of all relatively independent entities that participate in signatures but are related according to certain rules is called a signature system. The signature subsystem is a subset of all signers.
* Signature structure: In a multi-signature system, each member of any subsystem in the signature system signs a file according to a specific inheritance relationship. This inheritance relationship is called a signature structure of the signature system. The signature structure can be represented by a directed graph, in which the vertices represent the entities participating in the signature, and the directed edges represent the connection relationship, that is, the flow direction of the data.

In the early days of development, multi-digital signatures were divided into two categories according to different signature structures: ordered multi-signatures, that is, the order of signatures between signers is a serial order, and broadcast multi-signatures, that is, signatures between signers. Sequence is a parallel sequence. Later, a signature scheme with a more general signature structure was proposed: structured multi-signature. In a structured signature scheme, each member signs according to a pre-specified signature structure.

* Multi-signature is when multiple users digitally sign the same message.
* Depending on the signature process, multi-signature schemes can be divided into two categories: ordered multi-digital signature schemes and broadcast multi-digital signature schemes.
* Each scheme has three processes: system initialization, signature generation and signature verification.
* Each scheme contains three objects: message sender, message signer and signature verifier. Broadcast multi-signature schemes also include signature collectors.



### 2. Bitcoin multi-signature process
